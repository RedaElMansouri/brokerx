{
    "info": {
    "name": "BrokerX Prototype",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "description": "Collection Postman pour le prototype BrokerX"
    },
    "variable": [
    { "key": "baseUrl", "value": "http://localhost:3000" },
    { "key": "token", "value": "" }
    ],
    "item": [
    {
        "name": "Auth Login",
        "request": {
        "method": "POST",
        "header": [ { "key": "Content-Type", "value": "application/json" } ],
        "url": { "raw": "{{baseUrl}}/api/v1/auth/login", "host": ["{{baseUrl}}"], "path": ["api","v1","auth","login"] },
        "body": { "mode": "raw", "raw": "{\n  \"email\": \"demo@brokerx.test\",\n  \"password\": \"password\"\n}" }
        }
    },
    {
        "name": "Verify MFA",
        "request": {
        "method": "POST",
        "header": [ { "key": "Content-Type", "value": "application/json" } ],
        "url": { "raw": "{{baseUrl}}/api/v1/auth/verify_mfa", "host": ["{{baseUrl}}"], "path": ["api","v1","auth","verify_mfa"] },
        "body": { "mode": "raw", "raw": "{\n  \"email\": \"demo@brokerx.test\",\n  \"code\": \"000000\"\n}" }
        },
        "event": [
        {
            "listen": "test",
            "script": {
            "type": "text/javascript",
            "exec": [
                "let ok = false;",
                "try {",
                "  const json = pm.response.json();",
                "  if (json && json.token) {",
                "    pm.collectionVariables.set('token', json.token);",
                "    ok = true;",
                "  }",
                "} catch(e) {",
                "  console.log('Parse error', e);",
                "}",
                "pm.test('JWT token captured', function(){ pm.expect(ok, 'token present').to.be.true; });"
            ]
            }
        }
        ]
    },
    {
        "name": "Deposit Create",
        "request": {
        "method": "POST",
        "header": [
            { "key": "Content-Type", "value": "application/json" },
            { "key": "Idempotency-Key", "value": "{{$randomUUID}}" },
            { "key": "Authorization", "value": "Bearer {{token}}" }
        ],
        "url": { "raw": "{{baseUrl}}/api/v1/deposits", "host": ["{{baseUrl}}"], "path": ["api","v1","deposits"] },
        "body": { "mode": "raw", "raw": "{\n  \"amount\": 1000.0,\n  \"currency\": \"USD\"\n}" }
        }
    },
    {
        "name": "Deposits List",
        "request": {
        "method": "GET",
        "header": [ { "key": "Authorization", "value": "Bearer {{token}}" } ],
        "url": { "raw": "{{baseUrl}}/api/v1/deposits", "host": ["{{baseUrl}}"], "path": ["api","v1","deposits"] }
        }
    },
    {
        "name": "Portfolio",
        "request": {
        "method": "GET",
        "header": [ { "key": "Authorization", "value": "Bearer {{token}}" } ],
        "url": { "raw": "{{baseUrl}}/api/v1/portfolio", "host": ["{{baseUrl}}"], "path": ["api","v1","portfolio"] }
        }
    },
    {
        "name": "Order Create (buy)",
        "request": {
        "method": "POST",
        "header": [ { "key": "Content-Type", "value": "application/json" }, { "key": "Authorization", "value": "Bearer {{token}}" } ],
        "url": { "raw": "{{baseUrl}}/api/v1/orders", "host": ["{{baseUrl}}"], "path": ["api","v1","orders"] },
        "body": { "mode": "raw", "raw": "{\n  \"order\": {\n    \"symbol\": \"AAPL\",\n    \"order_type\": \"limit\",\n    \"direction\": \"buy\",\n    \"quantity\": 1,\n    \"price\": 100.0\n  }\n}" }
        }
    },
    {
        "name": "Order Create (sell)",
        "request": {
        "method": "POST",
        "header": [ { "key": "Content-Type", "value": "application/json" }, { "key": "Authorization", "value": "Bearer {{token}}" } ],
        "url": { "raw": "{{baseUrl}}/api/v1/orders", "host": ["{{baseUrl}}"], "path": ["api","v1","orders"] },
        "body": { "mode": "raw", "raw": "{\n  \"order\": {\n    \"symbol\": \"AAPL\",\n    \"order_type\": \"market\",\n    \"direction\": \"sell\",\n    \"quantity\": 1\n  }\n}" }
        }
    },
    {
        "name": "Order Show",
        "request": {
        "method": "GET",
        "header": [ { "key": "Authorization", "value": "Bearer {{token}}" } ],
        "url": { "raw": "{{baseUrl}}/api/v1/orders/1", "host": ["{{baseUrl}}"], "path": ["api","v1","orders","1"] }
        }
    },
    {
        "name": "Order Replace",
        "request": {
        "method": "POST",
        "header": [ { "key": "Content-Type", "value": "application/json" }, { "key": "Authorization", "value": "Bearer {{token}}" } ],
        "url": { "raw": "{{baseUrl}}/api/v1/orders/1/replace", "host": ["{{baseUrl}}"], "path": ["api","v1","orders","1","replace"] },
        "body": { "mode": "raw", "raw": "{\n  \"order\": {\n    \"client_version\": 0,\n    \"quantity\": 2\n  }\n}" }
        }
    },
    {
        "name": "Order Cancel",
        "request": {
        "method": "POST",
        "header": [ { "key": "Content-Type", "value": "application/json" }, { "key": "Authorization", "value": "Bearer {{token}}" } ],
        "url": { "raw": "{{baseUrl}}/api/v1/orders/1/cancel", "host": ["{{baseUrl}}"], "path": ["api","v1","orders","1","cancel"] },
        "body": { "mode": "raw", "raw": "{\n  \"client_version\": 0\n}" }
        }
    }
    ]
}
